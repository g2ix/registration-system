// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String
  role      Role     @default(STAFF)
  createdAt DateTime @default(now())

  checkins  Attendance[] @relation("CheckinBy")
  checkouts Attendance[] @relation("CheckoutBy")
}

enum Role {
  ADMIN
  STAFF
  ELECTION
}

model Member {
  id              String         @id @default(cuid())
  usccmpc_id      String         @unique
  firstName       String
  lastName        String
  middleName      String?
  suffix          String?
  membership_type MembershipType
  email1          String?
  email2          String?
  contactNumber   String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  voted           Boolean        @default(false)
  voted_at        DateTime?

  attendance Attendance[]

  @@index([firstName])
  @@index([lastName])
  @@index([usccmpc_id])
  @@index([lastName, firstName])
}

enum MembershipType {
  Regular
  Associate
}

model Attendance {
  id                   String           @id @default(cuid())
  member_id            String
  member               Member           @relation(fields: [member_id], references: [id])
  queue_number         Int
  checkin_at           DateTime         @default(now())
  checkin_by_id        String
  checkin_by           User             @relation("CheckinBy", fields: [checkin_by_id], references: [id])
  checkout_at          DateTime?
  checkout_by_id       String?
  checkout_by          User?            @relation("CheckoutBy", fields: [checkout_by_id], references: [id])
  checkout_number_given Int?
  claimed_by           String?          // name of person claiming on behalf of member (optional)
  stub_collected       Boolean          @default(true)  // was the physical stub returned?
  status               AttendanceStatus @default(Correct)

  @@index([member_id])
  @@index([checkin_at])
  @@index([member_id, checkout_at])
  @@unique([queue_number])   // enforced atomically by SQLite â€” no two rows share a queue number
}

enum AttendanceStatus {
  Correct
  Lost
  Mismatch
}

model EventConfig {
  id              Int     @id @default(autoincrement())
  title           String  @default("USCC-MPC Event")
  checkinEnabled  Boolean @default(false)
  checkoutEnabled Boolean @default(false)
}
